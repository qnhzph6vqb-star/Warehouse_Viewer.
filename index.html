<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Warehouse Location Viewer</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#14b8a6}
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",sans-serif}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);padding:24px}
  .wrap{max-width:980px;margin:0 auto}
  .card{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:20px 18px;box-shadow:0 10px 24px rgba(0,0,0,.3)}
  h1{margin:0 0 14px 0;font-size:28px}
  .pill{display:inline-block;background:var(--accent);color:#062a27;font-weight:700;border-radius:999px;padding:6px 12px;margin-right:8px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:10px 0 16px}
  input[type=text]{flex:1;min-width:200px;background:#0b1220;border:1px solid #233046;color:var(--text);border-radius:9px;padding:10px 12px}
  button{background:var(--accent);border:0;color:#062a27;font-weight:700;border-radius:9px;padding:10px 14px;cursor:pointer}
  .muted{color:var(--muted)}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.08);text-align:left;font-size:14px}
  th{color:#cfe6ff}
  .empty{padding:26px 8px;color:#b6c2cf}
  footer{margin-top:14px;color:#90a1b2;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1><span class="pill" id="locTag">—</span>Warehouse Location Viewer</h1>
    <div class="row">
      <div class="muted">Use <b>?loc=K10-03</b> in the URL, or type below</div>
    </div>
    <div class="row">
      <input id="locInput" type="text" placeholder="e.g. L15-08 or K10-03">
      <button id="openBtn">Open</button>
    </div>
    <div id="content"></div>
    <footer>Rendered locally • Updated: <span id="ts"></span> UTC</footer>
  </div>
</div>

<script>
const CSV_URL = "warehouse_data.csv"; // same folder

function fmt(n){return Intl.NumberFormat().format(n)}
function getParam(name){
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}
function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(x=>x.trim().length>0);
  if(lines.length===0) return {headers:[],rows:[]};
  const headers = lines[0].split(",").map(h=>h.trim());
  const rows = lines.slice(1).map(line=>{
    const cells = [];
    let cur="", inQ=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='\"'){
        if(inQ && line[i+1]==='\"'){cur+='\"'; i++;}
        else inQ=!inQ;
      } else if(ch===',' && !inQ){cells.push(cur); cur="";}
      else cur+=ch;
    }
    cells.push(cur);
    const obj={};
    headers.forEach((h,idx)=>obj[h]=cells[idx]!==undefined?cells[idx]:"");
    return obj;
  });
  return {headers,rows};
}

function renderTable(rows, loc){
  const content = document.getElementById('content');
  document.getElementById('locTag').textContent = loc || "—";
  if(!loc){ content.innerHTML = `<div class="empty">No location selected. Add <b>?loc=K10-03</b> to the link.</div>`; return; }
  if(rows.length===0){ content.innerHTML = `<div class="empty">No items in this location</div>`; return; }
  const total = rows.reduce((s,r)=> s + (parseFloat(r.Qty)||0), 0);
  let html = `<div class="muted">Items in <b>${loc}</b> • Total Qty: <b>${fmt(total)}</b></div>`;
  html += `<table><thead><tr><th>Code</th><th>Name</th><th>Batch</th><th>EXP</th><th style="text-align:right">Qty</th></tr></thead><tbody>`;
  rows.forEach(r=>{
    html += `<tr><td>${r.Code||""}</td><td>${r.Name||""}</td><td>${r.Batch||""}</td><td>${r.EXP||""}</td><td style="text-align:right">${fmt(r.Qty||0)}</td></tr>`;
  });
  html += `</tbody></table>`;
  content.innerHTML = html;
}

async function main(){
  document.getElementById('ts').textContent = new Date().toISOString().slice(0,16).replace('T',' ');
  document.getElementById('openBtn').addEventListener('click', ()=>{
    const v = document.getElementById('locInput').value.trim();
    if(v){ const url = new URL(window.location.href); url.searchParams.set('loc', v); window.location.href = url.toString(); }
  });
  const resp = await fetch(CSV_URL, {cache:'no-store'});
  if(!resp.ok){ document.getElementById('content').innerHTML = `<div class="empty">Cannot load data file.</div>`; return; }
  const text = await resp.text();
  const csv = parseCSV(text);
  const loc = (getParam('loc')||"").trim();
  if(loc) document.getElementById('locInput').value = loc;
  const rows = csv.rows.filter(r => (r.LocationCode||"").trim().toUpperCase() === loc.toUpperCase());
  renderTable(rows, loc);
}
main();
</script>
</body>
</html>
